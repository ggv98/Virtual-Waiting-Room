<!DOCTYPE html>
<html>
<head>

    <meta charset="UTF-8">

    <link rel="stylesheet" href="css/user-style.css">
    <link rel="stylesheet" href="css/popup-form-style.css">

    <style>

        /* TODO think about exporting to external .css file */

        .header {
            margin-left: 10%;
        }

        input, select {
            display: block;
            width: 90%;
            margin: 10px auto;
        }

        .room-info {
            text-align: center;
        }

        /* .input-hour {
            display: inline;
            width: 45%;
        } */

    </style>

</head>

<body>

    <header class="header">
        <img src="img/sofia-uni-logo.jpg">

        <pre class="welcome-message"> 
            Добре дошъл, 
            <span id="user-name" class="name">Професор Професоров</span> </pre>
    </header>

    <section class="main-content">
        <h3> Активни стаи: </h3>
        <div id="rooms-container" class="rooms-container">
            <!-- <div class="room">
                <p class="meet-title"> Math </p>
                <p class="meet-start-end-hour"> 1-5 </p>
            </div> -->
            <!-- <div id="add-room-button" class="room"> <p>+</p> </div>   -->
        </div>
    </section>

    <div class="form-popup" id="myForm">
        <form id="create-exam-form" action="src/api.php/create-meet" method="POST" class="form-container">
            <h1>Създаване на стая</h1>

            <input id="meet-title" type="text" placeholder="Въведи заглавие на срещата" name="meet_title" required>

            <input type="text" placeholder="Въведи име на предмет" name="subject" required>

            <input type="number" placeholder="Въведи средна продължителност на среща" name="avg-duration" required>

            <label for="date"> Дата на среща </label>
            <input id="date" name="date" type="date" required>

            <label for="start-hour"> Начало на среща </label>
            <input id="start-hour" name="start-hour" type="time" onchange="updateEndHourOptions()" step="600" required>

            <label for="end-hour"> Край на среща </label>
            <input id="end-hour" name="end-hour" type="time" placeholder="Край" step="600" required>

            <select name="meet_address_type" required>
                <option disabled selected value>Тип на среща</option>
                <option>Онлайн</option>
                <option>На място</option>
            </select>

            <input type="text" placeholder="Адрес" name="address" required>

            <button onsubmit="addRoomToView()" type="submit" class="btn">Създаване</button>
            <button type="button" class="btn cancel" onclick="closeForm()">Затвори</button>

        </form>
    </div>

    <!-- <script src="update_username.js"></script> -->

    <script>

        function openForm(room) {
            document.getElementById("myForm").style.display = "block";

            // TODO set the submit button of the form to update the next exam (in the up right corner)
        }

        function closeForm() {
            document.getElementById("myForm").style.display = "none";
        }



        function updateEndHourOptions() {
            inputedStartHour = document.getElementById("start-hour").value;
            console.log(inputedStartHour);

            endHourInput = document.getElementById("end-hour");

            endHourInput.min = inputedStartHour;
        }



        // TODO isolate in function
        var url = 'src/api.php/get-teacher-waiting-rooms';
        var settings = {method: 'POST'};

        var res = fetch(url, settings)
                .then(response => response.json())
                .then(response => displayResponseToView(response["data"]))
                .catch(error => console.log(error));

        // TODO maybe isolate some functions that are common with student-home-page
        function displayResponseToView(rooms) {
            for (room of rooms) {
                displayRoom(room);
            }

            displayAddRoomButton();

            document.getElementById("add-room-button").addEventListener("click", openForm);
        }

        function getRoomTimeInterval(room) {
            var date = new Date(room["startTime"]);
            var startHour = date.getHours() + ":" + date.getMinutes();

            date = new Date(room["endTime"]);
            var endHour = date.getHours() + ":" + date.getMinutes();
            
            var timeInterval = startHour + " - " + endHour;
            
            return timeInterval;
        }
       
        function displayAddRoomButton() {
            var node = document.createElement("p");
            node.classList.add("room-info");
            node.innerText = "+";

            var room = document.createElement("div");
            room.id = "add-room-button";
            room.classList.add("room");
            room.appendChild(node);
            document.getElementById("rooms-container").appendChild(room);
        }

        function displayRoom(room) {
            var roomTitle = room["title"];
            var timeInterval = getRoomTimeInterval(room);
            
            var node1 = document.createElement("p");                 // Create a <li> node
            node1.classList.add("room-info");
            node1.innerText = roomTitle;

            var node2 = document.createElement("p");
            node2.classList.add("room-info");
            node2.innerText = timeInterval;

            var room = document.createElement("div");
            room.classList.add("room");
            room.appendChild(node1);
            room.appendChild(node2);

            document.getElementById("rooms-container").appendChild(room);
        }

        // adding room based on the form information
        // used on Submit-ing the form
        function addRoomToView() {
            var rooms_container = document.getElementById("rooms-container");
            rooms_container.removeChild(rooms_container.lastChild);

            var meet_title = document.getElementById("meet-title").innerHTML;
            var date = document.getElementById("date").innerHTML;
            var start_hour = document.getElementById("start-hour").innerHTML;
            var end_hour = document.getElementById("end-hour").innerHTML;

            // TODO add room
        }

    </script>

    <script src="script/update_username.js"></script>

</body>
</html>
